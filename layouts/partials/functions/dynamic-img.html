{{ if and ( isset . "ImagePath" ) ( ne .ImagePath "" ) }}
  {{ $pageImage := .Context.Page.Resources.GetMatch .ImagePath }}
  {{ $urlImage := resources.GetRemote ( .ImagePath | safeURL ) }}
  {{ $isPageResource := ne $pageImage nil }}

  {{ $image := cond $isPageResource $pageImage $urlImage }}

  {{ $tinyImage := $image.Resize "500x" }}
  {{ $smallImage := $image.Resize "800x" }}
  {{ $mediumImage := $image.Resize "1200x" }}
  {{ $largeImage := $image.Resize "1500x" }}

  <picture class="{{ .ContainerClass }}">
    <source media="(max-width:800px)" srcset={{ $smallImage.RelPermalink | safeURL }}>
    <source media="(min-width:800px)" srcset={{ $mediumImage.RelPermalink | safeURL }}>
    <source media="(min-width:1200px)" srcset={{ $largeImage.RelPermalink | safeURL }}>
    <img
      class="{{ .Class }}"
      src="{{ $image.RelPermalink | safeURL }}"
      alt='{{ cond (isset . "Alt") .Alt .Text }}'
      loading="lazy"
      width="{{ $image.Width }}"
      style="aspect-ratio: {{ $image.Width }}/{{ $image.Height }};"
    />
  </picture>
{{ end }}